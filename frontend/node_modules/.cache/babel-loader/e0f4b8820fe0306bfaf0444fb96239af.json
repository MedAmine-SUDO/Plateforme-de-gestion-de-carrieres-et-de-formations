{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst jwt_decode_1 = __importDefault(require(\"jwt-decode\"));\n\nexports.reducer = (state, action) => {\n  if (action.type === \"setSession\") {\n    state.storage.set(action.value);\n    return exports.getState(Object.assign({}, state, action.value));\n  }\n\n  if (action.type === \"removeSession\") {\n    window.localStorage.setItem(\"logout\", Date.now().toString());\n    state.storage.remove();\n    return exports.getState(Object.assign({}, state, {\n      expiration: null,\n      isAuthenticated: false,\n      profile: undefined,\n      accessToken: undefined,\n      idToken: undefined,\n      refreshToken: undefined,\n      token: undefined\n    }));\n  }\n\n  if (action.type === \"setErrorMessage\") {\n    return exports.getState(Object.assign({}, state, {\n      errorMessage: action.value\n    }));\n  }\n\n  throw new Error();\n};\n\nexports.getState = state => {\n  const profile = exports.getProfile(Object.assign({}, state));\n  const expiration = exports.getExpiration(Object.assign({}, state, {\n    profile\n  }));\n  const isAuthenticated = exports.getIsAuthenticated(Object.assign({}, state, {\n    expiration,\n    profile\n  }));\n  return Object.assign({}, state, {\n    expiration,\n    isAuthenticated,\n    profile\n  });\n};\n\nexports.getProfile = ({\n  accessToken,\n  idToken,\n  jwt,\n  profile,\n  profileFn,\n  token\n}) => {\n  if (profileFn) {\n    if (accessToken && idToken) {\n      profile = profileFn(idToken);\n    } else if (token) {\n      profile = profileFn(token);\n    }\n  } else if (jwt) {\n    if (accessToken && idToken) {\n      profile = jwt_decode_1.default(idToken);\n    } else if (token) {\n      profile = jwt_decode_1.default(token);\n    }\n  }\n\n  return profile;\n};\n\nexports.getExpiration = ({\n  expiration,\n  profile\n}) => {\n  if (expiration || expiration === null) {\n    return expiration;\n  }\n\n  if (profile && profile.exp) {\n    return new Date(profile.exp * 1000);\n  }\n\n  return new Date(Date.now() + 10 * 60 * 60 * 1000); // 10 hours\n};\n\nexports.getIsAuthenticated = ({\n  expiration,\n  profile\n}) => {\n  if (expiration === null && profile) {\n    return true;\n  }\n\n  if (expiration && profile) {\n    return Date.now() < expiration.valueOf();\n  }\n\n  return false;\n};","map":{"version":3,"sources":["../src/reducer.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst jwt_decode_1 = __importDefault(require(\"jwt-decode\"));\nexports.reducer = (state, action) => {\n    if (action.type === \"setSession\") {\n        state.storage.set(action.value);\n        return exports.getState(Object.assign({}, state, action.value));\n    }\n    if (action.type === \"removeSession\") {\n        window.localStorage.setItem(\"logout\", Date.now().toString());\n        state.storage.remove();\n        return exports.getState(Object.assign({}, state, { expiration: null, isAuthenticated: false, profile: undefined, accessToken: undefined, idToken: undefined, refreshToken: undefined, token: undefined }));\n    }\n    if (action.type === \"setErrorMessage\") {\n        return exports.getState(Object.assign({}, state, { errorMessage: action.value }));\n    }\n    throw new Error();\n};\nexports.getState = (state) => {\n    const profile = exports.getProfile(Object.assign({}, state));\n    const expiration = exports.getExpiration(Object.assign({}, state, { profile }));\n    const isAuthenticated = exports.getIsAuthenticated(Object.assign({}, state, { expiration, profile }));\n    return Object.assign({}, state, { expiration,\n        isAuthenticated,\n        profile });\n};\nexports.getProfile = ({ accessToken, idToken, jwt, profile, profileFn, token }) => {\n    if (profileFn) {\n        if (accessToken && idToken) {\n            profile = profileFn(idToken);\n        }\n        else if (token) {\n            profile = profileFn(token);\n        }\n    }\n    else if (jwt) {\n        if (accessToken && idToken) {\n            profile = jwt_decode_1.default(idToken);\n        }\n        else if (token) {\n            profile = jwt_decode_1.default(token);\n        }\n    }\n    return profile;\n};\nexports.getExpiration = ({ expiration, profile }) => {\n    if (expiration || expiration === null) {\n        return expiration;\n    }\n    if (profile && profile.exp) {\n        return new Date(profile.exp * 1000);\n    }\n    return new Date(Date.now() + 10 * 60 * 60 * 1000); // 10 hours\n};\nexports.getIsAuthenticated = ({ expiration, profile }) => {\n    if (expiration === null && profile) {\n        return true;\n    }\n    if (expiration && profile) {\n        return Date.now() < expiration.valueOf();\n    }\n    return false;\n};\n//# sourceMappingURL=reducer.js.map"]},"metadata":{},"sourceType":"script"}